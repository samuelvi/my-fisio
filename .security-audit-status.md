# Security Audit Status

**Last Updated**: 2026-01-24
**Status**: In Progress

## Completed

### Critical Severity
| # | Vulnerability | Status | Commit |
|---|---------------|--------|--------|
| 1 | Credentials in .env.prod | ✅ Already in .gitignore | - |
| 2 | JWT_PASSPHRASE exposed | ✅ Placeholder + instructions | c330ca5 |

### High Severity
| # | Vulnerability | Status | Commit |
|---|---------------|--------|--------|
| 3 | IDOR generalized | ✅ N/A (single-tenant by design) | 8ac5286 |
| 4 | Endpoints without auth | ✅ Protected with IsGranted | 5173472 |
| 5 | Infrastructure exposure | ✅ Token required for details | 6a30cbd |
| 6 | AuditTrail public | ✅ N/A (single-tenant by design) | 8ac5286 |
| 7 | JWT TTL 15 days | ✅ Reduced to 2 hours | f849c1e |
| 8 | VITE_AUTH_* exposed | ✅ Documented as dev convenience | d3718ce |

### Medium Severity (Partial)
| # | Vulnerability | Status | Commit |
|---|---------------|--------|--------|
| 13 | Appointments userId writable | ✅ Server assigns from auth user | 8050feb |

## Pending - Medium Severity

| # | Vulnerability | Description |
|---|---------------|-------------|
| 9 | Filter validation | `DoctrineInvoiceRepository.php:199-204` - order param |
| 10 | Twig get_env() unrestricted | `EnvironmentExtension.php:19-22` |
| 11 | InvoiceExport no ownership | `InvoiceExportController.php:34-66` (N/A single-tenant) |
| 12 | InvoicePrefill no ownership | `InvoicePrefillController.php:30` (N/A single-tenant) |
| 14 | DateTime without validation | `AppointmentGapController.php:47-48` |
| 15 | LIKE without wildcard escape | `DoctrineInvoiceRepository.php:185-196` |
| 16 | No rate limiting | Global |
| 17 | CORS misconfigured | `.env.prod:5` |
| 18 | Logo path traversal | `InvoiceExportController.php:77-85` |
| 19 | DomPDF remote enabled | `InvoiceExportController.php:110` |
| 20 | Content-Disposition injection | `InvoiceExportController.php:123` |

## Pending - Low Severity

| # | Vulnerability | Description |
|---|---------------|-------------|
| 21 | Debug mode in dev | Expected behavior |
| 22 | Exception messages leak details | Production should be generic |
| 23 | Invoice number enumeration | Search endpoint |
| 24 | AuditTrail no RBAC | N/A single-tenant |
| 25 | No HTTPS/HSTS enforcement | Depends on reverse proxy |
| 26 | Missing security headers | X-Frame-Options, CSP, etc. |
| 27 | InvoiceLineInput no validation | Quantity/price limits |
| 28 | No CSRF | N/A - JWT stateless |

## Skills Created

- `.skills/secrets-management/SKILL.md` - Credential handling
- `.skills/security-model/SKILL.md` - Single-tenant security model
- `.skills/dangerous-defaults/SKILL.md` - Parameter safety

## Notes

- Application is **single-tenant** (one clinic, shared data)
- IDOR vulnerabilities do not apply (by design)
- Ownership checks not needed (all authenticated users share access)
